<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
        <script type="text/javascript">
        
        Web3 = require('web3');

        var abi = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "contractAddress",
				"type": "address"
			}
		],
		"name": "contract_created",
		"type": "event"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_awardTitle",
				"type": "string"
			},
			{
				"name": "_nominatorName",
				"type": "string"
			},
			{
				"name": "_awardInfo",
				"type": "string"
			},
			{
				"name": "_recipientName",
				"type": "string"
			},
			{
				"name": "_recipientAddr",
				"type": "address"
			},
			{
				"name": "_date",
				"type": "uint256"
			}
		],
		"name": "createAward",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getDeployedAwards",
		"outputs": [
			{
				"name": "",
				"type": "address[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "registeredAwards",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
];

var awardABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "endorser",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "count",
				"type": "uint256"
			}
		],
		"name": "endorsement",
		"type": "event"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "collect",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_endorserName",
				"type": "string"
			}
		],
		"name": "endorse",
		"outputs": [],
		"payable": true,
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"name": "_nominatorAddr",
				"type": "address"
			},
			{
				"name": "_nominatorName",
				"type": "string"
			},
			{
				"name": "_recipientAddr",
				"type": "address"
			},
			{
				"name": "_awardTitle",
				"type": "string"
			},
			{
				"name": "_awardInfo",
				"type": "string"
			},
			{
				"name": "_recipientName",
				"type": "string"
			},
			{
				"name": "_date",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "awardDate",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "awardInfo",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "awardTitle",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "endorserAddresses",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "endorserNames",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "endorsmentCounter",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "x",
				"type": "uint8"
			}
		],
		"name": "getEndorserAddress",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "x",
				"type": "uint8"
			}
		],
		"name": "getEndorserName",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "recipient",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "recipientName",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
];

        window.addEventListener('load', function () {
            console.log(abi);
            console.log(typeof web3);
            if (typeof web3 !== 'undefined') {
                console.log('Web3 Detected! '); // + web3.arguments + Object.getOwnPropertyNames(web3.arguments))
                web3.currentProvider.enable();
                window.web3 = new Web3(web3.currentProvider);   
            } else {
                console.log('No Web3 Detected.  Please install MetaMask or equivalent wallet.')
                /* window.web3 = new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/noapikey")); */
            }

            var CommunityAwardRegistry = web3.eth.contract(abi).at('0xfd6ee9bfc8f5236f18be700bf6e5d382478fac51');

            var from_user = {from:"0xD9Df5a24e05111C14eAd75b26e7A0e12AC2A30e9"};

            CommunityAwardRegistry.getDeployedAwards.call(from_user, function(err, addresses) {
                    var numAddresses = addresses.length;
                    for (var i = 0; i < numAddresses; i++) {
                        addr = addresses[i];
                        console.log(addr);
                        var Award = web3.eth.contract(awardABI).at(addr);

                        Award.awardTitle.call(from_user, function(err, data) {
                            console.log(data);
                        });

                        Award.awardInfo.call(from_user, function(err, data) {
                            console.log(data);
                        });

                        Award.recipientName.call(from_user, function(err, data) {
                            console.log(data);
                        });

                        Award.getBalance.call(from_user, function(err, data) {
                            console.log("getBalance"); /* See https://ethereum.stackexchange.com/questions/22859/how-to-get-value-of-a-contract-public-property-using-web3-eth */
                            console.log(data.toString());
                        });

                        Award.endorsmentCounter.call(from_user, function(err, data) {
                            console.log("endorsementCounter");
                            var cnt = Number(data.toString());
                            console.log(cnt);

                            for (i = 0; i < cnt; i++) { 
                                console.log("EndorserName?" + i.toString());
                                Award.getEndorserName.call(i, from_user, function(err, data) {console.log("e" + i.toString() + " " + data)});
                            }
                        });
                    }
                });
        })
        function getBalance() {
            var address, wei, balance
            address = document.getElementById("address").value
            try {
                web3.eth.getBalance(address, function (error, wei) {
                    if (!error) {
                        var balance = web3.fromWei(wei, 'ether');
                        document.getElementById("output").innerHTML = balance + " ETH";
                    }
                });
            } catch (err) {
                document.getElementById("output").innerHTML = err;
            }
        }
    </script>
</head>
<body>
    <h1>ETH Balance Fetcher</h1>
    <p>Enter your Ethereum Address:</p>
    <input type="text" size="50" id="address" value="0xD9Df5a24e05111C14eAd75b26e7A0e12AC2A30e9"/>
    <button type="button" onClick="getBalance();">Get Balance</button>
    <br />
    <br />
    <div id="output"></div>
</body>
</html>